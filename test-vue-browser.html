<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Validator - Live Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #667eea;
        }
        .header p {
            margin: 0;
            color: #666;
        }
        .registration-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .registration-form h2 {
            margin-top: 0;
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group input.error {
            border-color: #dc3545;
            background-color: #fff5f5;
        }
: 10px 0 0 0;
            padding-left: 20px;
        }
        .error-summary li {
            margin-bottom: 5px;
        }
        button[type="submit"] {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        button[type="submit"]:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .checkbox label {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        .success-message {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>✨ Vue Validator Test</h1>
                <p>This demonstrates the Vue form validation example working in a real browser environment.</p>
            </div>

            <form @submit.prevent="handleSubmit" class="registration-form">
                <h2>Create Account</h2>

                <div class="form-group">
                    <label for="username">Username</label>
                    <input
                        id="username"
                        v-model="formData.username"
                        type="text"
                        placeholder="Enter username (3-20 chars)"
                        :class="{ error: getUsernameError() }"
                    />
                    <span v-if="getUsernameError()" class="error-message">
                        {{ getUsernameError() }}
                    </span>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input
                        id="email"
                        v-model="formData.email"
                        type="email"
                        placeholder="your@email.com"
                        :class="{ error: getEmailError() }"
                    />
                    <span v-if="getEmailError()" class="error-message">
                        {{ getEmailError() }}
                    </span>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input
                        id="password"
                        v-model="formData.password"
                        type="password"
                        placeholder="Min 8 chars, uppercase, lowercase, number"
                        :class="{ error: getPasswordError() }"
                    />
                    <span v-if="getPasswordError()" class="error-message">
                        {{ getPasswordError() }}
                    </span>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input
                        id="confirmPassword"
                        v-model="formData.confirmPassword"
                        type="password"
                        placeholder="Re-enter password"
                        :class="{ error: getConfirmPasswordError() }"
                    />
                    <span v-if="getConfirmPasswordError()" class="error-message">
                        {{ getConfirmPasswordError() }}
                    </span>
                </div>

                <div class="form-group">
                    <label for="age">Age</label>
                    <input
                        id="age"
                        v-model.number="formData.age"
                        type="number"
                        placeholder="Must be 18 or older"
                        :class="{ error: getAgeError() }"
                    />
                    <span v-if="getAgeError()" class="error-message">
                        {{ getAgeError() }}
                    </span>
                </div>

                <div class="form-group checkbox">
                    <label>
                        <input
                            v-model="formData.acceptTerms"
                            type="checkbox"
                        />
                        I accept the terms and conditions
                    </label>
                    <span v-if="getAcceptTermsError()" class="error-message">
                        {{ getAcceptTermsError() }}
                    </span>
                </div>

                <button type="submit" :disabled="isValidating">
                    {{ isValidating ? 'Validating...' : 'Register' }}
                </button>

                <div v-if="showSuccess" class="success-message">
                    ✅ Registration successful! Form has been reset.
                </div>

                <div v-if="errors.length > 0" class="error-summary">
                    <h4>⚠️ Please fix the following errors:</h4>
                    <ul>
                        <li v-for="(error, index) in errors" :key="index">
                            {{ error.message }}
                        </li>
                    </ul>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { string, number, boolean, object } from './dist/index.js';
        import { useValidation } from './dist/adapters/vue.js';

        const { createApp, ref } = Vue;

        createApp({
            setup() {
                // Define the validation schema
                const registrationSchema = object({
                    username: string()
                        .min(3, 'Username must be at least 3 characters')
                        .max(20, 'Username cannot exceed 20 characters')
                        .pattern(/^[a-zA-Z0-9_]+$/, 'Username can only contain letters, numbers, and underscores'),

                    email: string()
                        .email('Please enter a valid email address'),

                    password: string()
                        .min(8, 'Password must be at least 8 characters')
                        .refine(
                            (val) => /[A-Z]/.test(val) && /[a-z]/.test(val) && /[0-9]/.test(val),
                            'Password must contain uppercase, lowercase, and a number'
                        ),

                    confirmPassword: string(),

                    age: number()
                        .int('Age must be a whole number')
                        .min(18, 'You must be at least 18 years old')
                        .max(120, 'Please enter a valid age'),

                    acceptTerms: boolean()
                        .refine((val) => val, 'You must accept the terms and conditions'),
                }).refine(
                    (data) => data.password === data.confirmPassword,
                    'Passwords must match'
                );

                // Form data
                const formData = ref({
                    username: '',
                    email: '',
                    password: '',
                    confirmPassword: '',
                    age: undefined,
                    acceptTerms: false,
                });

                const showSuccess = ref(false);

                // Initialize validation composable
                const { validate, errors, isValidating, getFieldError, clearErrors } =
                    useValidation({ schema: registrationSchema });

                // Helper functions to get field errors
                const getUsernameError = () => getFieldError('username').value?.message;
                const getEmailError = () => getFieldError('email').value?.message;
                const getPasswordError = () => getFieldError('password').value?.message;
                const getConfirmPasswordError = () => getFieldError('confirmPassword').value?.message;
                const getAgeError = () => getFieldError('age').value?.message;
                const getAcceptTermsError = () => getFieldError('acceptTerms').value?.message;

                // Handle form submission
                const handleSubmit = async () => {
                    showSuccess.value = false;
                    const result = await validate(formData.value);

                    if (result.success) {
                        console.log('Form submitted successfully:', result.data);
                        showSuccess.value = true;
                        clearErrors();

                        // Reset form after 2 seconds
                        setTimeout(() => {
                            formData.value = {
                                username: '',
                                email: '',
                                password: '',
                                confirmPassword: '',
                                age: undefined,
                                acceptTerms: false,
                            };
                            showSuccess.value = false;
                        }, 2000);
                    } else {
                        console.error('Validation errors:', result.errors);
                    }
                };

                return {
                    formData,
                    errors,
                    isValidating,
                    showSuccess,
                    getUsernameError,
                    getEmailError,
                    getPasswordError,
                    getConfirmPasswordError,
                    getAgeError,
                    getAcceptTermsError,
                    handleSubmit,
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
